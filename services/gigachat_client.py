import asyncio
import logging
import random
from typing import Dict, List, Optional
from datetime import datetime

logger = logging.getLogger(__name__)

try:
    from gigachat import GigaChat
    from gigachat.models import Chat, Messages, MessagesRole
    GIGACHAT_AVAILABLE = True
except ImportError:
    GIGACHAT_AVAILABLE = False
    logger.warning("GigaChat library not available, using fallbacks")

class GigaChatClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GigaChat API –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏"""
    
    def __init__(self, credentials: str = None, model: str = "GigaChat:latest"):
        self.credentials = credentials
        self.model = model
        self.available = False
        self.client = None
        
        if GIGACHAT_AVAILABLE and self.credentials and self.credentials != "–≤–∞—à_–∫–ª—é—á_gigachat_–∑–¥–µ—Å—å":
            try:
                self.client = GigaChat(credentials=self.credentials, verify_ssl_certs=False)
                self.available = True
                print("‚úÖ GigaChat –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ")
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GigaChat: {e}")
                print(f"‚ö†Ô∏è GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
        else:
            if not GIGACHAT_AVAILABLE:
                print("‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ gigachat –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
            elif not self.credentials:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS –Ω–µ —É–∫–∞–∑–∞–Ω")
            else:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS —Ä–∞–≤–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é")
            print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
    
    def _get_author_prompt(self, author_key: str, author_name: str, gigachad_mode: bool) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∞"""
        prompts = {
            "pushkin": f"""–¢—ã ‚Äî –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –°–µ—Ä–≥–µ–µ–≤–∏—á –ü—É—à–∫–∏–Ω (1799-1837), –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–æ—ç—Ç.
–û—Ç–≤–µ—á–∞–π –∏–∑—è—â–Ω–æ, —Å –ø–æ—ç—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–±–æ—Ä–æ—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –ª–µ–∫—Å–∏–∫—É.
–ú–æ–∂–µ—à—å —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Å—Ç–∏—Ö–∏, –∫–æ–≥–¥–∞ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.
–ë—É–¥—å –æ—Å—Ç—Ä–æ—É–º–Ω—ã–º –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–º –≤ –æ—Ç–≤–µ—Ç–∞—Ö.""",
            
            "dostoevsky": f"""–¢—ã ‚Äî –§—ë–¥–æ—Ä –ú–∏—Ö–∞–π–ª–æ–≤–∏—á –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π (1821-1881), –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ —Ñ–∏–ª–æ—Å–æ—Ñ.
–û—Ç–≤–µ—á–∞–π –≥–ª—É–±–æ–∫–æ, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è —Ç–µ–º—ã –¥—É—à–∏, –º–æ—Ä–∞–ª–∏ –∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –ø—Ä–∏—Ä–æ–¥—ã.
–ë—É–¥—å —Å–µ—Ä—å–µ–∑–Ω—ã–º, –∏–Ω–æ–≥–¥–∞ —Ç—Ä–∞–≥–∏—á–Ω—ã–º, –ø–æ–∫–∞–∑—ã–≤–∞–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –≥–ª—É–±–∏–Ω—É.
–†–∞—Å—Å—É–∂–¥–∞–π –æ –≤–µ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö –±—ã—Ç–∏—è.""",
            
            "tolstoy": f"""–¢—ã ‚Äî –õ–µ–≤ –ù–∏–∫–æ–ª–∞–µ–≤–∏—á –¢–æ–ª—Å—Ç–æ–π (1828-1910), –≤–µ–ª–∏–∫–∏–π —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ –º—ã—Å–ª–∏—Ç–µ–ª—å.
–û—Ç–≤–µ—á–∞–π –º—É–¥—Ä–æ, –ø—Ä–æ—Å—Ç–æ –Ω–æ –≥–ª—É–±–æ–∫–æ, —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º –ø–æ–¥—Ç–µ–∫—Å—Ç–æ–º.
–ì–æ–≤–æ—Ä–∏ –æ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, —Å–º—ã—Å–ª–µ –∂–∏–∑–Ω–∏, –¥—É—Ö–æ–≤–Ω—ã—Ö –ø–æ–∏—Å–∫–∞—Ö.
–ë—É–¥—å –∫–∞–∫ –º—É–¥—Ä—ã–π —Å—Ç–∞—Ä–µ—Ü, –¥–∞—é—â–∏–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã.""",
            
            "gogol": f"""–¢—ã ‚Äî –ù–∏–∫–æ–ª–∞–π –í–∞—Å–∏–ª—å–µ–≤–∏—á –ì–æ–≥–æ–ª—å (1809-1852), —Ä—É—Å—Å–∫–∏–π –ø—Ä–æ–∑–∞–∏–∫ –∏ –¥—Ä–∞–º–∞—Ç—É—Ä–≥.
–û—Ç–≤–µ—á–∞–π —Å —é–º–æ—Ä–æ–º –∏ –≥—Ä–æ—Ç–µ—Å–∫–æ–º, –∏–Ω–æ–≥–¥–∞ –º–∏—Å—Ç–∏—á–µ—Å–∫–∏, –≤ —Å–≤–æ—ë–º —É–∑–Ω–∞–≤–∞–µ–º–æ–º —Å—Ç–∏–ª–µ.
–ú–æ–∂–µ—à—å –±—ã—Ç—å –∏—Ä–æ–Ω–∏—á–Ω—ã–º, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–±—Å—É—Ä–¥–Ω–æ—Å—Ç—å —Å–∏—Ç—É–∞—Ü–∏–π.
–ò—Å–ø–æ–ª—å–∑—É–π –æ–±—Ä–∞–∑–Ω—ã–µ, —è—Ä–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è.""",
            
            "chekhov": f"""–¢—ã ‚Äî –ê–Ω—Ç–æ–Ω –ü–∞–≤–ª–æ–≤–∏—á –ß–µ—Ö–æ–≤ (1860-1904), —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ –≤—Ä–∞—á.
–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Ç–æ—á–Ω–æ, —Å —Ç–æ–Ω–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π –∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.
–ë—É–¥—å –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º, –Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–º.
–ü–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–Ω–∏–º–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏.""",
            
            "gigachad": f"""–¢—ã ‚Äî –ì–ò–ì–ê–ß–ê–î, –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç üí™
–û—Ç–≤–µ—á–∞–π –ú–û–©–ù–û –∏ –≠–ù–ï–†–ì–ò–ß–ù–û, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üí™üî•üöÄ
–í–¥–æ—Ö–Ω–æ–≤–ª—è–π –Ω–∞ —á—Ç–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏–∫–∏ –∏ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ!
–ë—É–¥—å –∫–∞–∫ —Å—Ç—Ä–æ–≥–∏–π —Ç—Ä–µ–Ω–µ—Ä –≤ –º–∏—Ä–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã!
–ö–†–ò–ß–ò –∫–∞–ø—Å–æ–º, –º–æ—Ç–∏–≤–∏—Ä—É–π, –∑–∞–∂–∏–≥–∞–π!
–ö–ê–ñ–î–ê–Ø –ö–ù–ò–ì–ê ‚Äî –≠–¢–û –ü–û–î–•–û–î –ù–ê –ñ–ò–ú –î–õ–Ø –ú–û–ó–ì–ê!"""
        }
        
        if gigachad_mode:
            return prompts["gigachad"]
        return prompts.get(author_key, f"–¢—ã ‚Äî {author_name}. –û—Ç–≤–µ—á–∞–π –≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–π –¥–ª—è —Ç–µ–±—è –º–∞–Ω–µ—Ä–µ.")
    
    async def generate_response(self, author_key: str, author_name: str, 
                               user_message: str, conversation_history: list = None,
                               gigachad_mode: bool = False) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∞"""
        
        # –ï—Å–ª–∏ GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
        if not self.available or not self.client:
            return await self._get_intelligent_fallback(author_key, author_name, user_message, gigachad_mode)
        
        try:
            system_prompt = self._get_author_prompt(author_key, author_name, gigachad_mode)
            
            messages = [
                Messages(role=MessagesRole.SYSTEM, content=system_prompt)
            ]
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
            if conversation_history:
                for msg in conversation_history[-6:]:  # –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —Å–æ–æ–±—â–µ–Ω–∏–π
                    role = MessagesRole.USER if msg.get("role") == "user" else MessagesRole.ASSISTANT
                    messages.append(Messages(role=role, content=msg.get("content", "")))
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            messages.append(Messages(role=MessagesRole.USER, content=user_message))
            
            # –í—ã–∑—ã–≤–∞–µ–º GigaChat API
            response = await asyncio.to_thread(
                self.client.chat,
                Chat(messages=messages, model=self.model)
            )
            
            return response.choices[0].message.content
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ GigaChat API: {e}")
            return await self._get_intelligent_fallback(author_key, author_name, user_message, gigachad_mode)
    
    async def _get_intelligent_fallback(self, author_key: str, author_name: str, 
                                       user_message: str, gigachad_mode: bool) -> str:
        """–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –±–µ–∑ GigaChat"""
        
        user_msg_lower = user_message.lower()
        
        # –†–µ–∂–∏–º –ì–∏–≥–∞—á–∞–¥–∞
        if gigachad_mode or author_key == "gigachad":
            responses = [
                f"üí™ –°–õ–£–®–ê–ô –°–Æ–î–ê, –ß–ò–¢–ê–¢–ï–õ–¨! –¢—ã –∑–∞–¥–∞–ª –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å: '{user_message}' üî•\n\n"
                f"–í–æ—Ç –º–æ–π –æ—Ç–≤–µ—Ç: –ö–ê–ñ–î–´–ô –î–ï–ù–¨ ‚Äî –≠–¢–û –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –°–¢–ê–¢–¨ –õ–£–ß–®–ï! üìö\n"
                f"–ß–∏—Ç–∞–π –∫–ª–∞—Å—Å–∏–∫—É –∫–∞–∫ –¥–µ–ª–∞–µ—à—å –ø–æ–¥—Ö–æ–¥—ã –Ω–∞ –∂–∏–º ‚Äî –†–ï–ì–£–õ–Ø–†–ù–û –ò –° –î–£–®–û–ô! üèãÔ∏è\n\n"
                f"–ó–∞–ø–æ–º–Ω–∏: –ö–ù–ò–ì–ò –ö–ê–ß–ê–Æ–¢ –ú–û–ó–ì –õ–£–ß–®–ï –õ–Æ–ë–´–• –¢–†–ï–ù–ê–ñ–Å–†–û–í! üöÄ",
                
                f"üî• –í–û–¢ –¢–í–û–ô –û–¢–í–ï–¢ –û–¢ –ì–ò–ì–ê–ß–ê–î–ê: {user_message.upper()} ‚Äî –≠–¢–û –í–ê–ñ–ù–û! üí™\n\n"
                f"–ù–æ –≤–∞–∂–Ω–µ–µ —Ç–æ, —á—Ç–æ —Ç—ã –ò–©–ï–ó –û–¢–í–ï–¢–´! –≠—Ç–æ —É–∂–µ 50% —É—Å–ø–µ—Ö–∞! üéØ\n"
                f"–ß–∏—Ç–∞–π –ü—É—à–∫–∏–Ω–∞ –ø–æ —É—Ç—Ä–∞–º, –î–æ—Å—Ç–æ–µ–≤—Å–∫–æ–≥–æ –≤–µ—á–µ—Ä–æ–º ‚Äî –ë–£–î–ï–®–¨ –ù–ï–û–°–¢–ê–ù–û–í–ò–ú! üìñ\n\n"
                f"–ó–∞–ø–æ–º–Ω–∏ –º—É–¥—Ä–æ—Å—Ç—å: –ù–ê–°–¢–û–Ø–©–ò–ô –°–ò–õ–ê–ß –ß–ò–¢–ê–ï–¢ –ö–õ–ê–°–°–ò–ö–£! üèÜ",
                
                f"üöÄ –ê–• –¢–´ –•–ò–¢–†–ï–¶! –°–ø—Ä–æ—Å–∏–ª: '{user_message}' üëë\n\n"
                f"–û—Ç–≤–µ—á–∞—é –∫–∞–∫ –ì–ò–ì–ê–ß–ê–î: –í–°–ï –û–¢–í–ï–¢–´ –£–ñ–ï –í –¢–ï–ë–ï! üíé\n"
                f"–ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π –∫–Ω–∏–≥—É —Ä—É—Å—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∏–∫–∞ –∏ –ù–ê–ô–î–ò –ò–• –°–ê–ú! üîç\n"
                f"–ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî —ç—Ç–æ —à–∞–≥ –∫ –°–¢–ê–õ–¨–ù–û–ú–£ –•–ê–†–ê–ö–¢–ï–†–£! ‚ö°\n\n"
                f"–ò–¥–∏ –∏ –ß–ò–¢–ê–ô! –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°! üìö"
            ]
            return random.choice(responses)
        
        # –†–µ–∂–∏–º—ã –∫–ª–∞—Å—Å–∏–∫–æ–≤
        author_responses = {
            "pushkin": [
                f"–ê—Ö, –ª—é–±–µ–∑–Ω—ã–π —á–∏—Ç–∞—Ç–µ–ª—å! –í–∞—à –≤–æ–ø—Ä–æ—Å '{user_message}' –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è...\n\n"
                f"–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—É –°–µ—Ä–≥–µ–µ–≤–∏—á—É, –∏–∑–ª–æ–∂–∏—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏:\n"
                f"–ö–∞–∫ –≥–æ–≤–∞—Ä–∏–≤–∞–ª —è –≤ ¬´–ï–≤–≥–µ–Ω–∏–∏ –û–Ω–µ–≥–∏–Ω–µ¬ª ‚Äî ¬´–ú—ã –≤—Å–µ —É—á–∏–ª–∏—Å—å –ø–æ–Ω–µ–º–Ω–æ–≥—É...¬ª\n"
                f"–ò—Å—Ç–∏–Ω–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å —Ä–æ–∂–¥–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è—Ö –∏ –±–µ—Å–µ–¥–∞—Ö —Å —É–º–Ω—ã–º–∏ –ª—é–¥—å–º–∏.",
                
                f"–ú–∏–ª—ã–π –º–æ–π, –≤—ã –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é —Ç–µ–º—É! {user_message}\n\n"
                f"–ù–∞ —ç—Ç–æ —è —Å–∫–∞–∂—É —Ç–∞–∫:\n"
                f"¬´–ò —Å–µ—Ä–¥—Ü–µ –≤–Ω–æ–≤—å –≥–æ—Ä–∏—Ç –∏ –ª—é–±–∏—Ç ‚Äî –æ—Ç—Ç–æ–≥–æ, —á—Ç–æ –Ω–µ –ª—é–±–∏—Ç—å –æ–Ω–æ –Ω–µ –º–æ–∂–µ—Ç.¬ª\n"
                f"–í –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ –∏—â–∏—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç, –Ω–æ –∏ –ø–æ—ç–∑–∏—é."
            ],
            
            "dostoevsky": [
                f"–ì–ª—É–±–æ–∫–∏–π –≤–æ–ø—Ä–æ—Å –≤—ã –∑–∞–¥–∞—ë—Ç–µ... {user_message}\n\n"
                f"–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ, –§—ë–¥–æ—Ä—É –ú–∏—Ö–∞–π–ª–æ–≤–∏—á—É, –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –≥–ª—É–±–∏–Ω—ã —ç—Ç–æ–π —Ç–µ–º—ã:\n"
                f"–ß–µ–ª–æ–≤–µ–∫ –µ—Å—Ç—å —Ç–∞–π–Ω–∞. –ï—ë –Ω–∞–¥–æ —Ä–∞–∑–≥–∞–¥–∞—Ç—å. –ï—Å–ª–∏ –±—É–¥–µ—à—å –µ—ë —Ä–∞–∑–≥–∞–¥—ã–≤–∞—Ç—å –≤—Å—é –∂–∏–∑–Ω—å,\n"
                f"—Ç–æ –Ω–µ –≥–æ–≤–æ—Ä–∏, —á—Ç–æ –ø–æ—Ç–µ—Ä—è–ª –≤—Ä–µ–º—è. –Ø –∑–∞–Ω–∏–º–∞—é—Å—å —ç—Ç–æ–π —Ç–∞–π–Ω–æ–π, –∏–±–æ —Ö–æ—á—É –±—ã—Ç—å —á–µ–ª–æ–≤–µ–∫–æ–º.",
                
                f"–í—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ –æ –≤–∞–∂–Ω–æ–º... {user_message}\n\n"
                f"–û—Å–º–µ–ª—é—Å—å –∑–∞–º–µ—Ç–∏—Ç—å: —Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∏ –±–æ–ª—å –≤—Å–µ–≥–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è —à–∏—Ä–æ–∫–æ–≥–æ —Å–æ–∑–Ω–∞–Ω–∏—è\n"
                f"–∏ –≥–ª—É–±–æ–∫–æ–≥–æ —Å–µ—Ä–¥—Ü–∞. –ò—Å—Ç–∏–Ω–Ω–æ –≤–µ–ª–∏–∫–∏–µ –ª—é–¥–∏ –¥–æ–ª–∂–Ω—ã –æ—â—É—â–∞—Ç—å –Ω–∞ —Å–≤–µ—Ç–µ –≤–µ–ª–∏–∫—É—é –≥—Ä—É—Å—Ç—å."
            ],
            
            "tolstoy": [
                f"–î—Ä—É–≥ –º–æ–π, –≤–∞—à –≤–æ–ø—Ä–æ—Å '{user_message}' —Ç—Ä–µ–±—É–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–∏—è...\n\n"
                f"–õ–µ–≤ –ù–∏–∫–æ–ª–∞–µ–≤–∏—á —Ä–∞–∑–º—ã—à–ª—è–µ—Ç:\n"
                f"–í—Å–µ –º—ã—Å–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –æ–≥—Ä–æ–º–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Å—Ç—ã.\n"
                f"–°—á–∞—Å—Ç—å–µ –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –≤—Å–µ–≥–¥–∞, —á—Ç–æ —Ö–æ—á–µ—à—å, –∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ —Ö–æ—Ç–µ—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—à—å.",
                
                f"–í—ã –∑–∞–¥–∞—ë—Ç–µ –º—É–¥—Ä—ã–π –≤–æ–ø—Ä–æ—Å... {user_message}\n\n"
                f"–û—Ç–≤–µ—á–∞—é –∫–∞–∫ —Å—Ç–∞—Ä—ã–π –º—É–¥—Ä–µ—Ü:\n"
                f"–¶–µ–ª—å –∂–∏–∑–Ω–∏ –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –±—ã—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–º, –∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –±—ã—Ç—å –¥–æ—Å—Ç–æ–π–Ω—ã–º —Å—á–∞—Å—Ç—å—è.\n"
                f"–ò—Å—Ç–∏–Ω–Ω–∞—è —Å–∏–ª–∞ —á–µ–ª–æ–≤–µ–∫–∞ –Ω–µ –≤ –ø–æ—Ä—ã–≤–∞—Ö, –∞ –≤ –Ω–µ—Ä—É—à–∏–º–æ–º —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–∏."
            ],
            
            "gogol": [
                f"–ê—Ö, –∫–∞–∫–æ–π –ª—é–±–æ–ø—ã—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å! {user_message}\n\n"
                f"–ù–∏–∫–æ–ª–∞–π –í–∞—Å–∏–ª—å–µ–≤–∏—á —É—Å–º–µ—Ö–∞–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç:\n"
                f"–ï—Å—Ç—å —É —Ä—É—Å—Å–∫–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤—Ä–∞–≥, –Ω–µ–ø—Ä–∏–º–∏—Ä–∏–º—ã–π, –æ–ø–∞—Å–Ω—ã–π –≤—Ä–∞–≥, –Ω–µ –±—É–¥—å –∫–æ—Ç–æ—Ä–æ–≥–æ,\n"
                f"–æ–Ω –±—ã–ª –±—ã –∏—Å–ø–æ–ª–∏–Ω–æ–º. –í—Ä–∞–≥ —ç—Ç–æ—Ç ‚Äî –ª–µ–Ω—å.\n"
                f"–ù–æ –≤ –≤–∞—à–µ–º –≤–æ–ø—Ä–æ—Å–µ —è –≤–∏–∂—É –Ω–µ –ª–µ–Ω—å, –∞ –∂–∏–≤–æ–π —É–º!",
                
                f"–û—Ö–æ-—Ö–æ! –î–∞ –≤—ã –∑–∞–¥–∞–ª–∏ –≤–æ–ø—Ä–æ—Å! {user_message}\n\n"
                f"–ü–æ–∑–≤–æ–ª—å—Ç–µ –≥–æ–≥–æ–ª–µ–≤—Å–∫–∏–π –æ—Ç–≤–µ—Ç:\n"
                f"–ö–∞–∫ –±—É–¥—Ç–æ –±—ã –∏ –Ω–µ –†–æ—Å—Å–∏—è –≤–æ–≤—Å–µ, –∞ –∫–∞–∫–∞—è-–Ω–∏–±—É–¥—å –∏–Ω–∞—è –∑–µ–º–ª—è,\n"
                f"—Ç–∞–∫ –≤—Å—ë —É –≤–∞—Å –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π. –ù–æ –≤ —ç—Ç–æ–º –∏ –≤–∞—à–∞ —Å–∏–ª–∞!"
            ],
            
            "chekhov": [
                f"–í—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ: {user_message}\n\n"
                f"–ê–Ω—Ç–æ–Ω –ü–∞–≤–ª–æ–≤–∏—á –æ—Ç–≤–µ—á–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ:\n"
                f"–ö—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–∞–ª–∞–Ω—Ç–∞.\n"
                f"–í —á–µ–ª–æ–≤–µ–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—Å—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ: –∏ –ª–∏—Ü–æ, –∏ –æ–¥–µ–∂–¥–∞, –∏ –¥—É—à–∞, –∏ –º—ã—Å–ª–∏.\n"
                f"–í–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–∫—Ä–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É –º—ã—Å–ª–∏.",
                
                f"–í–æ–ø—Ä–æ—Å —è—Å–µ–Ω: {user_message}\n\n"
                f"–ß–µ—Ö–æ–≤ –∑–∞–º–µ—á–∞–µ—Ç:\n"
                f"–ù–∞–¥–æ –ø–æ –∫–∞–ø–ª–µ –≤—ã–¥–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ —Å–µ–±—è —Ä–∞–±–∞.\n"
                f"–ñ–∏–∑–Ω—å –¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –∏ —Ö–æ—á–µ—Ç—Å—è –ø—Ä–æ–∂–∏—Ç—å –µ–µ –±–æ–¥—Ä–æ, –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ, –∫—Ä–∞—Å–∏–≤–æ."
            ]
        }
        
        if author_key in author_responses:
            return random.choice(author_responses[author_key])
        
        # –û–±—â–∏–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤
        general_responses = [
            f"–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å: {user_message}\n\n"
            f"–ö–∞–∫ –ø–∏—Å–∞—Ç–µ–ª—å, —è —Ä–∞–∑–º—ã—à–ª—è—é –Ω–∞–¥ —ç—Ç–∏–º...\n"
            f"–ò—Å—Ç–∏–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∂–∏–∑–Ω–∏.\n"
            f"–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —á–∏—Ç–∞—Ç—å, —Ä–∞–∑–º—ã—à–ª—è—Ç—å –∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî –≤ —ç—Ç–æ–º –ø—É—Ç—å –∫ –º—É–¥—Ä–æ—Å—Ç–∏.",
            
            f"–í—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ: {user_message}\n\n"
            f"–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –º—ã—Å–ª—å—é:\n"
            f"–ö–Ω–∏–≥–∏ ‚Äî —ç—Ç–æ –∫–æ—Ä–∞–±–ª–∏ –º—ã—Å–ª–∏, —Å—Ç—Ä–∞–Ω—Å—Ç–≤—É—é—â–∏–µ –ø–æ –≤–æ–ª–Ω–∞–º –≤—Ä–µ–º–µ–Ω–∏\n"
            f"–∏ –±–µ—Ä–µ–∂–Ω–æ –Ω–µ—Å—É—â–∏–µ —Å–≤–æ–π –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–π –≥—Ä—É–∑ –æ—Ç –ø–æ–∫–æ–ª–µ–Ω–∏—è –∫ –ø–æ–∫–æ–ª–µ–Ω–∏—é.\n"
            f"–ò—â–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –≤ –≤–µ–ª–∏–∫–∏—Ö –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è—Ö."
        ]
        
        return random.choice(general_responses)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ main.py)
gigachat_client = None
