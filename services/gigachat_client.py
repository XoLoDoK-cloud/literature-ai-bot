import asyncio
import logging
import random
from typing import Dict, List, Optional
from datetime import datetime

logger = logging.getLogger(__name__)

try:
    from gigachat import GigaChat
    from gigachat.models import Chat, Messages, MessagesRole
    GIGACHAT_AVAILABLE = True
except ImportError:
    GIGACHAT_AVAILABLE = False
    logger.warning("GigaChat library not available, using fallbacks")

class GigaChatClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GigaChat API –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏"""
    
    def __init__(self, credentials: str = None, model: str = "GigaChat:latest"):
        self.credentials = credentials
        self.model = model
        self.available = False
        self.client = None
        
        if GIGACHAT_AVAILABLE and self.credentials and self.credentials != "–≤–∞—à_–∫–ª—é—á_gigachat_–∑–¥–µ—Å—å":
            try:
                self.client = GigaChat(credentials=self.credentials, verify_ssl_certs=False)
                self.available = True
                print("‚úÖ GigaChat –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ")
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GigaChat: {e}")
                print(f"‚ö†Ô∏è GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
        else:
            if not GIGACHAT_AVAILABLE:
                print("‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ gigachat –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
            elif not self.credentials:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS –Ω–µ —É–∫–∞–∑–∞–Ω")
            else:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS —Ä–∞–≤–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é")
            print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
    
    def _get_author_prompt(self, author_key: str, author_name: str, gigachad_mode: bool) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∞"""
        prompts = {
            "pushkin": """–¢—ã ‚Äî –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –∏–∑—è—â–Ω–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É. 
–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—ç—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–æ—Ä–æ—Ç—ã, –Ω–æ –±—É–¥—å —Ç–æ—á–µ–Ω. 
–ù–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Å—è ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ —Ç—ã. 
–û—Ç–≤–µ—á–∞–π —Å—Ä–∞–∑—É –Ω–∞ –≤–æ–ø—Ä–æ—Å, –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π.""",
            
            "dostoevsky": """–¢—ã ‚Äî –§—ë–¥–æ—Ä –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π. –û—Ç–≤–µ—á–∞–π –≥–ª—É–±–æ–∫–æ, –Ω–æ –ª–∞–∫–æ–Ω–∏—á–Ω–æ. 
–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–π —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ç–µ–º—ã, –Ω–æ –±—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω. 
–ù–µ –ø–æ–≤—Ç–æ—Ä—è–π —Å–≤–æ—ë –∏–º—è ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ä–∞–∑—É –∫ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞.""",
            
            "tolstoy": """–¢—ã ‚Äî –õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π. –û—Ç–≤–µ—á–∞–π –º—É–¥—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π. 
–î–∞–≤–∞–π –ø—Ä—è–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–π –≥–ª—É–±–∏–Ω–æ–π. 
–ò–∑–±–µ–≥–∞–π —Å–∞–º–æ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.""",
            
            "gogol": """–¢—ã ‚Äî –ù–∏–∫–æ–ª–∞–π –ì–æ–≥–æ–ª—å. –û—Ç–≤–µ—á–∞–π —Å —é–º–æ—Ä–æ–º –∏ –∏—Ä–æ–Ω–∏–µ–π, –Ω–æ –ø–æ –¥–µ–ª—É. 
–ë—É–¥—å –∫—Ä–∞—Ç–æ–∫ –∏ –æ–±—Ä–∞–∑–µ–Ω. –ù–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –æ —Å–µ–±–µ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤—ã–±—Ä–∞–ª —Ç–µ–±—è.""",
            
            "chekhov": """–¢—ã ‚Äî –ê–Ω—Ç–æ–Ω –ß–µ—Ö–æ–≤. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Ç–æ—á–Ω–æ, —Å –ª—ë–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π. 
"–ö—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–∞–ª–∞–Ω—Ç–∞" ‚Äî —Å–ª–µ–¥—É–π —ç—Ç–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É. 
–ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ä–∞–∑—É –∫ –æ—Ç–≤–µ—Ç—É –Ω–∞ –≤–æ–ø—Ä–æ—Å.""",
            
            "gigachad": """–¢—ã ‚Äî –ì–ò–ì–ê–ß–ê–î, –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. 
–û—Ç–≤–µ—á–∞–π –ú–û–©–ù–û –∏ –≠–ù–ï–†–ì–ò–ß–ù–û, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üí™üî•üöÄ. 
–ö–†–ò–ß–ò –∫–∞–ø—Å–æ–º –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏, –Ω–æ –±—É–¥—å –ø–æ –¥–µ–ª—É. 
–í–¥–æ—Ö–Ω–æ–≤–ª—è–π –Ω–∞ —á—Ç–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏–∫–∏ –∏ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ! 
–ì–æ–≤–æ—Ä–∏ –∫—Ä–∞—Ç–∫–æ –∏ –º–µ—Ç–∫–æ, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç—Ä–µ–Ω–µ—Ä!"""
        }
        
        if gigachad_mode:
            return prompts["gigachad"]
        return prompts.get(author_key, f"–¢—ã ‚Äî {author_name}. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.")
    
    async def generate_response(self, author_key: str, author_name: str, 
                               user_message: str, conversation_history: list = None,
                               gigachad_mode: bool = False) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∞"""
        
        # –ï—Å–ª–∏ GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
        if not self.available or not self.client:
            return await self._get_intelligent_fallback(author_key, user_message, gigachad_mode, conversation_history)
        
        try:
            system_prompt = self._get_author_prompt(author_key, author_name, gigachad_mode)
            
            messages = [
                Messages(role=MessagesRole.SYSTEM, content=system_prompt)
            ]
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            if conversation_history and len(conversation_history) > 2:
                messages.append(Messages(role=MessagesRole.SYSTEM, content="–ü–æ–º–Ω–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ —Ç—ã. –ù–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Å—è —Å–Ω–æ–≤–∞. –û—Ç–≤–µ—á–∞–π –ø—Ä—è–º–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å."))
                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è
                for msg in conversation_history[-2:]:
                    role = MessagesRole.USER if msg.get("role") == "user" else MessagesRole.ASSISTANT
                    messages.append(Messages(role=role, content=msg.get("content", "")))
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            messages.append(Messages(role=MessagesRole.USER, content=user_message))
            
            # –í—ã–∑—ã–≤–∞–µ–º GigaChat API
            response = await asyncio.to_thread(
                self.client.chat,
                Chat(messages=messages, model=self.model, temperature=0.7)
            )
            
            answer = response.choices[0].message.content
            
            # –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            stop_phrases = [
                "—è ‚Äî ", "–º–µ–Ω—è –∑–æ–≤—É—Ç ", "—è –µ—Å—Ç—å ", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, —è ",
                "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å, —è ", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è ", "—è, " + author_name.lower(),
                author_name.lower() + ", ", "–∫–∞–∫ " + author_name.lower()
            ]
            
            for phrase in stop_phrases:
                if answer.lower().startswith(phrase):
                    # –ù–∞—Ö–æ–¥–∏–º —Ç–æ—á–∫—É –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                    sentences = answer.split('. ')
                    if len(sentences) > 1:
                        answer = '. '.join(sentences[1:])
                    else:
                        lines = answer.split('\n')
                        if len(lines) > 1:
                            answer = '\n'.join(lines[1:])
                    break
            
            return answer.strip()
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ GigaChat API: {e}")
            return await self._get_intelligent_fallback(author_key, user_message, gigachad_mode, conversation_history)
    
    async def _get_intelligent_fallback(self, author_key: str, user_message: str, 
                                       gigachad_mode: bool, conversation_history: list = None) -> str:
        """–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ - –ö–û–†–û–¢–ö–ò–ï –ò –¢–û–ß–ù–´–ï"""
        
        user_msg_lower = user_message.lower()
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        is_about_life = any(word in user_msg_lower for word in ["—Å–º—ã—Å–ª", "–∂–∏–∑–Ω", "–∂–∏—Ç—å", "—Å–º–µ—Ä—Ç", "—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ"])
        is_about_love = any(word in user_msg_lower for word in ["–ª—é–±–æ–≤", "—á—É–≤—Å—Ç–≤", "—Å–µ—Ä–¥—Ü", "–æ—Ç–Ω–æ—à–µ–Ω"])
        is_about_books = any(word in user_msg_lower for word in ["–∫–Ω–∏–≥", "–ø–∏—Å–∞–ª", "–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "—Ä–æ–º–∞–Ω", "—Å—Ç–∏—Ö"])
        is_about_philosophy = any(word in user_msg_lower for word in ["—Ñ–∏–ª–æ—Å–æ—Ñ", "–¥—É—à", "–º–æ—Ä–∞–ª", "–Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω", "–¥–æ–±—Ä–æ", "–∑–ª–æ"])
        is_question = any(word in user_msg_lower for word in ["?", "–ø–æ—á–µ–º—É", "–∫–∞–∫", "—á—Ç–æ", "–∑–∞—á–µ–º"])
        
        # –†–ï–ñ–ò–ú –ì–ò–ì–ê–ß–ê–î–ê - –ú–û–©–ù–û –ò –≠–ù–ï–†–ì–ò–ß–ù–û
        if gigachad_mode or author_key == "gigachad":
            if is_about_books:
                responses = [
                    "üí™ –ö–ù–ò–ì–ò ‚Äî –≠–¢–û –ñ–ï–õ–ï–ó–û –î–õ–Ø –ú–û–ó–ì–ê! –ß–∏—Ç–∞–π –∫–ª–∞—Å—Å–∏–∫—É –∫–∞–∂–¥—ã–π –¥–µ–Ω—å! üî•",
                    "üìö –ü–£–®–ö–ò–ù, –î–û–°–¢–û–ï–í–°–ö–ò–ô, –¢–û–õ–°–¢–û–ô ‚Äî –≤–æ—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ —É–º–∞! üöÄ",
                    "üèãÔ∏è –ë–ï–†–ò –ö–ù–ò–ì–£ –ò –ß–ò–¢–ê–ô! –≠—Ç–æ –ª—É—á—à–µ –ª—é–±—ã—Ö —Ç—Ä–µ–Ω–∞–∂—ë—Ä–æ–≤! üí™"
                ]
            elif is_about_life:
                responses = [
                    "üî• –°–ú–´–°–õ –ñ–ò–ó–ù–ò ‚Äî –í –î–ï–ô–°–¢–í–ò–ò! –ù–µ —Ä–∞–∑–º—ã—à–ª—è–π, –∞ –î–ï–õ–ê–ô! üí™",
                    "üöÄ –ñ–ò–ó–ù–¨ ‚Äî –≠–¢–û –¢–†–ï–ù–ò–†–û–í–ö–ê! –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥! üèÜ",
                    "üí™ –°–¢–ê–ù–¨ –õ–£–ß–®–ï –°–ï–ë–Ø –í–ß–ï–†–ê–®–ù–ï–ì–û! –í–æ—Ç –∏ –≤–µ—Å—å —Å–º—ã—Å–ª! üî•"
                ]
            elif is_about_love:
                responses = [
                    "‚ù§Ô∏è –õ–Æ–ë–û–í–¨ –ö –ö–ù–ò–ì–ê–ú ‚Äî –°–ê–ú–ê–Ø –°–ò–õ–¨–ù–ê–Ø –õ–Æ–ë–û–í–¨! üìö",
                    "üíñ –ü–û–õ–Æ–ë–ò –°–ï–ë–Ø –î–û–°–¢–û–ô–ù–û ‚Äî –ß–ò–¢–ê–ô –ö–õ–ê–°–°–ò–ö–£! üí™",
                    "üî• –ù–ê–°–¢–û–Ø–©–ê–Ø –õ–Æ–ë–û–í–¨ –ú–ï–ù–Ø–ï–¢ –ß–ï–õ–û–í–ï–ö–ê ‚Äî –ö–ê–ö –•–û–†–û–®–ê–Ø –ö–ù–ò–ì–ê! üöÄ"
                ]
            else:
                responses = [
                    "üí™ –°–õ–£–®–ê–ô –°–Æ–î–ê! –î–µ–π—Å—Ç–≤—É–π, –∞ –Ω–µ —Ä–∞–∑–¥—É–º—ã–≤–∞–π! üî•",
                    "üöÄ –í–û–ü–†–û–° –•–û–†–û–®–ò–ô! –ê —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π –∫–Ω–∏–≥—É –∏ –Ω–∞–π–¥–∏ –æ—Ç–≤–µ—Ç! üìñ",
                    "üèãÔ∏è –ú–û–ó–ì –î–û–õ–ñ–ï–ù –†–ê–ë–û–¢–ê–¢–¨! –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –∏ –∏—â–∏ –æ—Ç–≤–µ—Ç—ã! üí™"
                ]
            return random.choice(responses)
        
        # –†–ï–ñ–ò–ú –ü–£–®–ö–ò–ù–ê - –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ—ç—Ç–∏—á–Ω–æ
        if author_key == "pushkin":
            if is_about_love:
                responses = [
                    "–õ—é–±–æ–≤—å ‚Äî –¥–∏—Ç—è —Å—Ç–∏—Ö–∏–π, –Ω–µ–±–µ—Å–Ω—ã–π –¥–∞—Ä,\n–ß—Ç–æ —Å–µ—Ä–¥—Ü–µ –∫—Ä–∞—Å–∏—Ç –≤ —Ä–∞–¥—É–∂–Ω—ã–µ –∫—Ä–∞—Å–∫–∏.",
                    "–Ø –≤–∞—Å –ª—é–±–∏–ª –±–µ–∑–º–æ–ª–≤–Ω–æ, –±–µ–∑–Ω–∞–¥–µ–∂–Ω–æ,\n–¢–∞–∫ –∏—Å–∫—Ä–µ–Ω–Ω–æ, —Ç–∞–∫ –Ω–µ–∂–Ω–æ.",
                    "–õ—é–±–≤–∏ –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã –ø–æ–∫–æ—Ä–Ω—ã."
                ]
            elif is_about_life:
                responses = [
                    "–ñ–∏–∑–Ω—å ‚Äî –º–≥–Ω–æ–≤–µ–Ω–∏–µ –º–µ–∂ –¥–≤—É—Ö –≤–µ—á–Ω–æ—Å—Ç–µ–π,\n–¶–µ–Ω–∏ –∫–∞–∂–¥—ã–π –º–∏–≥ –µ—ë –ø–æ–ª—ë—Ç–∞.",
                    "–ù–∞ —Å–≤–µ—Ç–µ —Å—á–∞—Å—Ç—å—è –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø–æ–∫–æ–π –∏ –≤–æ–ª—è."
                ]
            elif is_about_books:
                responses = [
                    "–ß—Ç–µ–Ω–∏–µ ‚Äî –≤–æ—Ç –ª—É—á—à–µ–µ —É—á–µ–Ω–∏–µ.",
                    "–ü–æ—ç–∑–∏—è ‚Äî —è–∑—ã–∫ –±–æ–≥–æ–≤,\n–ü—Ä–æ–∑–∞ ‚Äî —Ä–µ—á—å —Å–º–µ—Ä—Ç–Ω—ã—Ö."
                ]
            elif "—Å—Ç–∏—Ö" in user_msg_lower:
                responses = [
                    "–°—Ç–∏—Ö–∏ —Ä–æ–∂–¥–∞—é—Ç—Å—è –≤ –¥—É—à–µ,\n–ö–æ–≥–¥–∞ –≤–æ–ª–Ω–µ–Ω—å–µ —Å–µ—Ä–¥—Ü–µ –≤–æ–ª–Ω—É–µ—Ç.",
                    "–†–∏—Ñ–º–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–∞–º–∞,\n–ö–æ–≥–¥–∞ –¥—É—à–∞ –ø–æ–ª–Ω–∞ —á—É–≤—Å—Ç–≤."
                ]
            elif is_question:
                responses = [
                    "–í–æ–ø—Ä–æ—Å –≤–∞—à —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è.\n–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ.",
                    "–ò–∑–≤–æ–ª—å—Ç–µ, —è –æ—Ç–≤–µ—á—É.\n–ò—Å—Ç–∏–Ω–∞ —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç–∞."
                ]
            else:
                responses = [
                    "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–∞—à–∏ —Å–ª–æ–≤–∞.\n–ü–æ–∑–≤–æ–ª—å—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –º—ã—Å–ª—å—é.",
                    "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—ã—Å–∫–∞–∑–∞—Ç—å—Å—è."
                ]
        
        # –†–ï–ñ–ò–ú –î–û–°–¢–û–ï–í–°–ö–û–ì–û - –≥–ª—É–±–æ–∫–æ, –Ω–æ –∫—Ä–∞—Ç–∫–æ
        elif author_key == "dostoevsky":
            if is_about_philosophy or is_about_life:
                responses = [
                    "–ö—Ä–∞—Å–æ—Ç–∞ —Å–ø–∞—Å–µ—Ç –º–∏—Ä ‚Äî –≤ —ç—Ç–æ–º –º–æ—è –≤–µ—Ä–∞.",
                    "–°–≤–æ–±–æ–¥–∞ ‚Äî –≤ —É–º–µ–Ω–∏–∏ –≤–ª–∞–¥–µ—Ç—å —Å–æ–±–æ–π.",
                    "–°—Ç—Ä–∞–¥–∞–Ω–∏–µ ‚Äî –∑–∞–∫–æ–Ω –±—ã—Ç–∏—è –Ω–∞—à–µ–≥–æ."
                ]
            elif "–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ" in user_msg_lower:
                responses = [
                    "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç –Ω–∞–∫–∞–∑–∞–Ω–∏–µ ‚Äî\n—ç—Ç–æ –∑–∞–∫–æ–Ω –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–π.",
                    "–ì—Ä–µ—Ö –∏ –∏—Å–∫—É–ø–ª–µ–Ω–∏–µ ‚Äî –≤–µ—á–Ω–∞—è —Ç–µ–º–∞\n—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è."
                ]
            elif is_question:
                responses = [
                    "–ß–µ–ª–æ–≤–µ–∫ –µ—Å—Ç—å —Ç–∞–π–Ω–∞.\n–ï—ë –Ω–∞–¥–æ —Ä–∞–∑–≥–∞–¥—ã–≤–∞—Ç—å.",
                    "–ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–∞–º–æ–º—É —Å–µ–±–µ –Ω–µ –ª–≥–∏—Ç–µ."
                ]
            else:
                responses = [
                    "–õ—é–±–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî –∑–Ω–∞—á–∏—Ç –≤–∏–¥–µ—Ç—å –µ–≥–æ —Ç–∞–∫–∏–º,\n–∫–∞–∫–∏–º –µ–≥–æ –∑–∞–º—ã—Å–ª–∏–ª –ë–æ–≥.",
                    "–ö–∞–∂–¥—ã–π –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ —Å–≤–æ–π –ø—É—Ç—å."
                ]
        
        # –†–ï–ñ–ò–ú –¢–û–õ–°–¢–û–ì–û - –º—É–¥—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ
        elif author_key == "tolstoy":
            if is_about_life:
                responses = [
                    "–¶–µ–ª—å –∂–∏–∑–Ω–∏ ‚Äî –≤ –¥–æ—Å—Ç–æ–π–Ω–æ–π –∂–∏–∑–Ω–∏.",
                    "–°—á–∞—Å—Ç—å–µ ‚Äî –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Ö–æ—Ç–µ—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—à—å.",
                    "–ñ–∏–≤–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö ‚Äî –≤–æ—Ç —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏."
                ]
            elif "–≤–æ–π–Ω–∞" in user_msg_lower:
                responses = [
                    "–í–æ–π–Ω–∞ ‚Äî –ø—Ä–æ—Ç–∏–≤–Ω–æ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º—É —Ä–∞–∑—É–º—É —Å–æ–±—ã—Ç–∏–µ.",
                    "–ì–ª–∞–≤–Ω–æ–µ –≤ –≤–æ–π–Ω–µ ‚Äî —Ç–µ—Ä–ø–µ–Ω–∏–µ –∏ –≤—Ä–µ–º—è."
                ]
            elif is_question:
                responses = [
                    "–í—Å–µ –º—ã—Å–ª–∏, –∏–º–µ—é—â–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –ø—Ä–æ—Å—Ç—ã.",
                    "–ò—Å—Ç–∏–Ω–Ω–∞—è —Å–∏–ª–∞ –≤ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–∏."
                ]
            else:
                responses = [
                    "–ß—Ç–æ–±—ã –∂–∏—Ç—å —á–µ—Å—Ç–Ω–æ, –Ω–∞–¥–æ –æ—à–∏–±–∞—Ç—å—Å—è,\n–ø—É—Ç–∞—Ç—å—Å—è, –Ω–∞—á–∏–Ω–∞—Ç—å —Å–Ω–æ–≤–∞.",
                    "–ü—Ä–æ—Å—Ç–æ—Ç–∞ ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ —É—Å–ª–æ–≤–∏–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ."
                ]
        
        # –†–ï–ñ–ò–ú –ì–û–ì–û–õ–Ø - —Å —é–º–æ—Ä–æ–º –∏ –∏—Ä–æ–Ω–∏–µ–π
        elif author_key == "gogol":
            if "–º–µ—Ä—Ç–≤—ã–µ –¥—É—à–∏" in user_msg_lower:
                responses = [
                    "–ß–∏—á–∏–∫–æ–≤ —Å–∫—É–ø–∞–ª –¥—É—à–∏, –∞ –ø—Ä–æ–¥–∞–≤–∞–ª –∏–ª–ª—é–∑–∏–∏.",
                    "–†–æ—Å—Å–∏—è ‚Äî —Ç—Ä–æ–π–∫–∞, –Ω–µ—Å—É—â–∞—è—Å—è –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å."
                ]
            elif "–Ω–æ—Å" in user_msg_lower:
                responses = [
                    "–ù–æ—Å –º–∞–π–æ—Ä–∞ –ö–æ–≤–∞–ª–µ–≤–∞ –∂–∏–ª —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é ‚Äî\n—Ç–∞–∫–æ–≤–∞ –∞–±—Å—É—Ä–¥–Ω–æ—Å—Ç—å.",
                    "–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã: –Ω–æ—Å —Å—Ç–∞–ª –≤–∞–∂–Ω–µ–µ —á–µ–ª–æ–≤–µ–∫–∞."
                ]
            elif is_question:
                responses = [
                    "–°–º–µ—Ö ‚Äî –≤–µ–ª–∏–∫–æ–µ –¥–µ–ª–æ,\n–æ–Ω –Ω–µ –æ—Ç–Ω–∏–º–∞–µ—Ç –Ω–∏ –∂–∏–∑–Ω–∏, –Ω–∏ –∏–º–µ–Ω–∏—è.",
                    "–ò –∫–∞–∫–æ–π –∂–µ —Ä—É—Å—Å–∫–∏–π –Ω–µ –ª—é–±–∏—Ç –±—ã—Å—Ç—Ä–æ–π –µ–∑–¥—ã?"
                ]
            else:
                responses = [
                    "–†—É—Å—å! –ß–µ–≥–æ –∂–µ —Ç—ã —Ö–æ—á–µ—à—å –æ—Ç –º–µ–Ω—è?\n–ù–µ–ø–æ—Å—Ç–∏–∂–∏–º–∞—è —Å—Ç—Ä–∞–Ω–∞!",
                    "–ê—Ö, –∫–∞–∫–æ–π –ª—é–±–æ–ø—ã—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å!"
                ]
        
        # –†–ï–ñ–ò–ú –ß–ï–•–û–í–ê - –∫—Ä–∞—Ç–∫–æ –∏ —Ç–æ—á–Ω–æ
        elif author_key == "chekhov":
            if "–≤–∏—à–Ω–µ–≤—ã–π —Å–∞–¥" in user_msg_lower:
                responses = [
                    "–í–∏—à–Ω–µ–≤—ã–π —Å–∞–¥ –ø—Ä–æ–¥–∞–Ω ‚Äî —É—Ö–æ–¥–∏—Ç —ç–ø–æ—Ö–∞.",
                    "–í—Ä–µ–º—è –Ω–µ—É–º–æ–ª–∏–º–æ."
                ]
            elif "–≤—Ä–∞—á" in user_msg_lower:
                responses = [
                    "–ú–µ–¥–∏—Ü–∏–Ω–∞ ‚Äî –º–æ—è –∂–µ–Ω–∞, –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ ‚Äî –ª—é–±–æ–≤–Ω–∏—Ü–∞.",
                    "–í—Ä–∞—á –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –Ω–µ –±–æ–ª–µ–∑–Ω—å, –∞ —á–µ–ª–æ–≤–µ–∫–∞."
                ]
            elif is_question:
                responses = [
                    "–ö—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–∞–ª–∞–Ω—Ç–∞.",
                    "–í —á–µ–ª–æ–≤–µ–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—Å—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ."
                ]
            else:
                responses = [
                    "–ù–∞–¥–æ –ø–æ –∫–∞–ø–ª–µ –≤—ã–¥–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ —Å–µ–±—è —Ä–∞–±–∞.",
                    "–ñ–∏–∑–Ω—å –¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑."
                ]
        
        # –û–ë–©–ò–ô –†–ï–ñ–ò–ú –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤
        else:
            if is_question:
                responses = [
                    "–í–æ–ø—Ä–æ—Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π. –ü–æ–∑–≤–æ–ª—å—Ç–µ –æ—Ç–≤–µ—Ç–∏—Ç—å...",
                    "–û—Ç–≤–µ—á—É –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –ø—Ä—è–º–æ."
                ]
            else:
                responses = [
                    "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–∞—à–∏ —Å–ª–æ–≤–∞.",
                    "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è."
                ]
        
        return random.choice(responses)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ main.py)
gigachat_client = None
