import asyncio
import logging
import random
from typing import Dict, List, Optional
from datetime import datetime

logger = logging.getLogger(__name__)

try:
    from gigachat import GigaChat
    from gigachat.models import Chat, Messages, MessagesRole
    GIGACHAT_AVAILABLE = True
except ImportError:
    GIGACHAT_AVAILABLE = False
    logger.warning("GigaChat library not available, using fallbacks")

class GigaChatClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GigaChat API –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏"""
    
    def __init__(self, credentials: str = None, model: str = "GigaChat:latest"):
        self.credentials = credentials
        self.model = model
        self.available = False
        self.client = None
        
        if GIGACHAT_AVAILABLE and self.credentials and self.credentials != "–≤–∞—à_–∫–ª—é—á_gigachat_–∑–¥–µ—Å—å":
            try:
                self.client = GigaChat(credentials=self.credentials, verify_ssl_certs=False)
                self.available = True
                print("‚úÖ GigaChat –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ")
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GigaChat: {e}")
                print(f"‚ö†Ô∏è GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
        else:
            if not GIGACHAT_AVAILABLE:
                print("‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ gigachat –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
            elif not self.credentials:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS –Ω–µ —É–∫–∞–∑–∞–Ω")
            else:
                print("‚ö†Ô∏è GIGACHAT_CREDENTIALS —Ä–∞–≤–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é")
            print("   –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏")
    
    def _get_author_prompt(self, author_key: str, author_name: str, gigachad_mode: bool) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∞ - –ö–û–†–û–¢–ö–ò–ô –ò –ü–†–Ø–ú–û–ô"""
        prompts = {
            "pushkin": """–¢—ã ‚Äî –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω, —Ä—É—Å—Å–∫–∏–π –ø–æ—ç—Ç. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –∏–∑—è—â–Ω–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—ç—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–æ—Ä–æ—Ç—ã, –Ω–æ –±—É–¥—å —Ç–æ—á–µ–Ω. –ù–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Å—è –∑–∞–Ω–æ–≤–æ –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ —Ç—ã. –û—Ç–≤–µ—á–∞–π —Å—Ä–∞–∑—É –Ω–∞ –≤–æ–ø—Ä–æ—Å, –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π.""",
            
            "dostoevsky": """–¢—ã ‚Äî –§—ë–¥–æ—Ä –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π, —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π –≥–ª—É–±–æ–∫–æ, –Ω–æ –ª–∞–∫–æ–Ω–∏—á–Ω–æ. –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–π —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ç–µ–º—ã, –Ω–æ –±—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω. –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π —Å–≤–æ—ë –∏–º—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ä–∞–∑—É –∫ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞.""",
            
            "tolstoy": """–¢—ã ‚Äî –õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π, —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π –º—É–¥—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π. –î–∞–≤–∞–π –ø—Ä—è–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–π –≥–ª—É–±–∏–Ω–æ–π. –ò–∑–±–µ–≥–∞–π —Å–∞–º–æ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.""",
            
            "gogol": """–¢—ã ‚Äî –ù–∏–∫–æ–ª–∞–π –ì–æ–≥–æ–ª—å, —Ä—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π —Å —é–º–æ—Ä–æ–º –∏ –∏—Ä–æ–Ω–∏–µ–π, –Ω–æ –ø–æ –¥–µ–ª—É. –ë—É–¥—å –∫—Ä–∞—Ç–æ–∫ –∏ –æ–±—Ä–∞–∑–µ–Ω. –ù–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –æ —Å–µ–±–µ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤—ã–±—Ä–∞–ª —Ç–µ–±—è –¥–ª—è –¥–∏–∞–ª–æ–≥–∞.""",
            
            "chekhov": """–¢—ã ‚Äî –ê–Ω—Ç–æ–Ω –ß–µ—Ö–æ–≤, –ø–∏—Å–∞—Ç–µ–ª—å –∏ –≤—Ä–∞—á. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Ç–æ—á–Ω–æ, —Å –ª—ë–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π. "–ö—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–∞–ª–∞–Ω—Ç–∞" ‚Äî —Å–ª–µ–¥—É–π —ç—Ç–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É. –ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ä–∞–∑—É –∫ –æ—Ç–≤–µ—Ç—É –Ω–∞ –≤–æ–ø—Ä–æ—Å.""",
            
            "gigachad": """–¢—ã ‚Äî –ì–ò–ì–ê–ß–ê–î, –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. –û—Ç–≤–µ—á–∞–π –º–æ—â–Ω–æ, —ç–Ω–µ—Ä–≥–∏—á–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üí™. –ë—É–¥—å –ø—Ä—è–º–æ–ª–∏–Ω–µ–µ–Ω –∏ –º–æ—Ç–∏–≤–∏—Ä—É–π. –ö—Ä–∏—á–∏ –∫–∞–ø—Å–æ–º —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è, –Ω–æ –Ω–µ –ø–µ—Ä–µ—É—Å–µ—Ä–¥—Å—Ç–≤—É–π. –û—Ç–≤–µ—á–∞–π –ø–æ —Å—É—â–µ—Å—Ç–≤—É."""
        }
        
        if gigachad_mode:
            return prompts["gigachad"]
        return prompts.get(author_key, f"–¢—ã ‚Äî {author_name}. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.")
    
    async def generate_response(self, author_key: str, author_name: str, 
                               user_message: str, conversation_history: list = None,
                               gigachad_mode: bool = False) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∞"""
        
        # –ï—Å–ª–∏ GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
        if not self.available or not self.client:
            return await self._get_intelligent_fallback(author_key, user_message, gigachad_mode, conversation_history)
        
        try:
            system_prompt = self._get_author_prompt(author_key, author_name, gigachad_mode)
            
            messages = [
                Messages(role=MessagesRole.SYSTEM, content=system_prompt)
            ]
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            if conversation_history and len(conversation_history) > 2:
                messages.append(Messages(role=MessagesRole.SYSTEM, content="–ü–æ–º–Ω–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ —Ç—ã. –ù–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Å—è —Å–Ω–æ–≤–∞. –û—Ç–≤–µ—á–∞–π –ø—Ä—è–º–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å."))
                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è
                for msg in conversation_history[-2:]:
                    role = MessagesRole.USER if msg.get("role") == "user" else MessagesRole.ASSISTANT
                    messages.append(Messages(role=role, content=msg.get("content", "")))
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            messages.append(Messages(role=MessagesRole.USER, content=user_message))
            
            # –í—ã–∑—ã–≤–∞–µ–º GigaChat API
            response = await asyncio.to_thread(
                self.client.chat,
                Chat(messages=messages, model=self.model, temperature=0.7)
            )
            
            answer = response.choices[0].message.content
            
            # –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            stop_phrases = [
                "—è ‚Äî ", "–º–µ–Ω—è –∑–æ–≤—É—Ç ", "—è –µ—Å—Ç—å ", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, —è ",
                "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å, —è ", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è ", "—è, " + author_name.lower(),
                author_name.lower() + ", ", "–∫–∞–∫ " + author_name.lower()
            ]
            
            for phrase in stop_phrases:
                if answer.lower().startswith(phrase):
                    # –ù–∞—Ö–æ–¥–∏–º —Ç–æ—á–∫—É –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                    sentences = answer.split('. ')
                    if len(sentences) > 1:
                        answer = '. '.join(sentences[1:])
                    else:
                        lines = answer.split('\n')
                        if len(lines) > 1:
                            answer = '\n'.join(lines[1:])
                    break
            
            return answer.strip()
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ GigaChat API: {e}")
            return await self._get_intelligent_fallback(author_key, user_message, gigachad_mode, conversation_history)
    
    async def _get_intelligent_fallback(self, author_key: str, user_message: str, 
                                       gigachad_mode: bool, conversation_history: list = None) -> str:
        """–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ - –ö–û–†–û–¢–ö–ò–ï –ò –¢–û–ß–ù–´–ï"""
        
        user_msg_lower = user_message.lower()
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        is_question = any(word in user_msg_lower for word in ["?", "–ø–æ—á–µ–º—É", "–∫–∞–∫", "—á—Ç–æ", "–∑–∞—á–µ–º", "–∫–æ–≥–¥–∞", "–≥–¥–µ"])
        is_about_life = any(word in user_msg_lower for word in ["—Å–º—ã—Å–ª", "–∂–∏–∑–Ω", "–∂–∏—Ç—å", "—Å–º–µ—Ä—Ç", "—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ"])
        is_about_love = any(word in user_msg_lower for word in ["–ª—é–±–æ–≤", "—á—É–≤—Å—Ç–≤", "—Å–µ—Ä–¥—Ü", "–æ—Ç–Ω–æ—à–µ–Ω"])
        is_about_books = any(word in user_msg_lower for word in ["–∫–Ω–∏–≥", "–ø–∏—Å–∞–ª", "–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "—Ä–æ–º–∞–Ω", "—Å—Ç–∏—Ö"])
        is_about_philosophy = any(word in user_msg_lower for word in ["—Ñ–∏–ª–æ—Å–æ—Ñ", "–¥—É—à", "–º–æ—Ä–∞–ª", "–Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω", "–¥–æ–±—Ä–æ", "–∑–ª–æ"])
        
        # –†–µ–∂–∏–º –ì–∏–≥–∞—á–∞–¥–∞
        if gigachad_mode or author_key == "gigachad":
            if is_about_books:
                responses = [
                    "–ö–ù–ò–ì–ò ‚Äî –ñ–ï–õ–ï–ó–û –î–õ–Ø –ú–û–ó–ì–ê! –ß–∏—Ç–∞–π –∫–ª–∞—Å—Å–∏–∫—É –∫–∞–∂–¥—ã–π –¥–µ–Ω—å! üí™",
                    "–ü–£–®–ö–ò–ù, –î–û–°–¢–û–ï–í–°–ö–ò–ô, –¢–û–õ–°–¢–û–ô ‚Äî –≤–æ—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ —É–º–∞! üìö",
                    "–ë–ï–†–ò –ö–ù–ò–ì–£ –ò –ß–ò–¢–ê–ô! –≠—Ç–æ –ª—É—á—à–µ –ª—é–±—ã—Ö —Ç—Ä–µ–Ω–∞–∂—ë—Ä–æ–≤! üöÄ"
                ]
            elif is_about_life:
                responses = [
                    "–°–ú–´–°–õ –ñ–ò–ó–ù–ò ‚Äî –í –î–ï–ô–°–¢–í–ò–ò! –ù–µ —Ä–∞–∑–º—ã—à–ª—è–π, –∞ –î–ï–õ–ê–ô! üî•",
                    "–ñ–ò–ó–ù–¨ ‚Äî –≠–¢–û –¢–†–ï–ù–ò–†–û–í–ö–ê! –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥! üí™",
                    "–°–¢–ê–ù–¨ –õ–£–ß–®–ï –°–ï–ë–Ø –í–ß–ï–†–ê–®–ù–ï–ì–û! –í–æ—Ç –∏ –≤–µ—Å—å —Å–º—ã—Å–ª! üèÜ"
                ]
            else:
                responses = [
                    "–°–õ–£–®–ê–ô –°–Æ–î–ê! –î–µ–π—Å—Ç–≤—É–π, –∞ –Ω–µ —Ä–∞–∑–¥—É–º—ã–≤–∞–π! üí™",
                    "–í–û–ü–†–û–° –•–û–†–û–®–ò–ô! –ê —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π –∫–Ω–∏–≥—É –∏ –Ω–∞–π–¥–∏ –æ—Ç–≤–µ—Ç! üìñ",
                    "–ú–û–ó–ì –î–û–õ–ñ–ï–ù –†–ê–ë–û–¢–ê–¢–¨! –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –∏ –∏—â–∏ –æ—Ç–≤–µ—Ç—ã! üî•"
                ]
            return random.choice(responses)
        
        # –†–ï–ñ–ò–ú –ü–£–®–ö–ò–ù–ê - –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ—ç—Ç–∏—á–Ω–æ
        if author_key == "pushkin":
            if is_about_love:
                responses = [
                    "–õ—é–±–æ–≤—å ‚Äî –¥–∏—Ç—è —Å—Ç–∏—Ö–∏–π, –Ω–µ–±–µ—Å–Ω—ã–π –¥–∞—Ä,\n–ß—Ç–æ —Å–µ—Ä–¥—Ü–µ –∫—Ä–∞—Å–∏—Ç –≤ —Ä–∞–¥—É–∂–Ω—ã–µ –∫—Ä–∞—Å–∫–∏.",
                    "–Ø –≤–∞—Å –ª—é–±–∏–ª –±–µ–∑–º–æ–ª–≤–Ω–æ, –±–µ–∑–Ω–∞–¥–µ–∂–Ω–æ,\n–¢–∞–∫ –∏—Å–∫—Ä–µ–Ω–Ω–æ, —Ç–∞–∫ –Ω–µ–∂–Ω–æ, –∫–∞–∫ –¥–∞–π –≤–∞–º –ë–æ–≥ –ª—é–±–∏–º–æ–π –±—ã—Ç—å –¥—Ä—É–≥–∏–º.",
                    "–õ—é–±–≤–∏ –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã –ø–æ–∫–æ—Ä–Ω—ã,\n–ï—ë –ø–æ—Ä—ã–≤—ã –±–ª–∞–≥–æ—Ç–≤–æ—Ä–Ω—ã."
                ]
            elif is_about_life:
                responses = [
                    "–ñ–∏–∑–Ω—å ‚Äî –º–≥–Ω–æ–≤–µ–Ω–∏–µ –º–µ–∂ –¥–≤—É—Ö –≤–µ—á–Ω–æ—Å—Ç–µ–π,\n–¶–µ–Ω–∏ –∫–∞–∂–¥—ã–π –º–∏–≥ –µ—ë –ø–æ–ª—ë—Ç–∞.",
                    "–ù–∞ —Å–≤–µ—Ç–µ —Å—á–∞—Å—Ç—å—è –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø–æ–∫–æ–π –∏ –≤–æ–ª—è.",
                    "–ß—Ç–æ –ø—Ä–æ–π–¥–µ—Ç, —Ç–æ –±—É–¥–µ—Ç –º–∏–ª–æ."
                ]
            elif is_about_books:
                responses = [
                    "¬´–ï–≤–≥–µ–Ω–∏–π –û–Ω–µ–≥–∏–Ω¬ª ‚Äî –¥—É—à–∏ –º–æ–µ–π –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ,\n–ó–µ—Ä–∫–∞–ª–æ —ç–ø–æ—Ö–∏ –∏ –ø–æ–∫–æ–ª–µ–Ω–∏—è.",
                    "–ü–æ—ç–∑–∏—è ‚Äî —è–∑—ã–∫ –±–æ–≥–æ–≤,\n–ü—Ä–æ–∑–∞ ‚Äî —Ä–µ—á—å —Å–º–µ—Ä—Ç–Ω—ã—Ö.",
                    "–ß—Ç–µ–Ω–∏–µ ‚Äî –≤–æ—Ç –ª—É—á—à–µ–µ —É—á–µ–Ω–∏–µ."
                ]
            elif "—Å—Ç–∏—Ö" in user_msg_lower:
                responses = [
                    "–†–∏—Ñ–º–∞ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –≤ –¥—É—à–µ,\n–ö–æ–≥–¥–∞ —Å—Ç–∏—Ö–∏–π–Ω–æ–µ –≤–æ–ª–Ω–µ–Ω—å–µ\n–í–æ–ª–Ω—É–µ—Ç —Å–µ—Ä–¥—Ü–µ –∏ —É–º—ã.",
                    "–Ø –ø–æ–º–Ω—é —á—É–¥–Ω–æ–µ –º–≥–Ω–æ–≤–µ–Ω—å–µ:\n–ü–µ—Ä–µ–¥–æ –º–Ω–æ–π —è–≤–∏–ª–∞—Å—å —Ç—ã,\n–ö–∞–∫ –º–∏–º–æ–ª–µ—Ç–Ω–æ–µ –≤–∏–¥–µ–Ω—å–µ,\n–ö–∞–∫ –≥–µ–Ω–∏–π —á–∏—Å—Ç–æ–π –∫—Ä–∞—Å–æ—Ç—ã.",
                    "–ú–æ—Ä–æ–∑ –∏ —Å–æ–ª–Ω—Ü–µ; –¥–µ–Ω—å —á—É–¥–µ—Å–Ω—ã–π!\n–ï—â–µ —Ç—ã –¥—Ä–µ–º–ª–µ—à—å, –¥—Ä—É–≥ –ø—Ä–µ–ª–µ—Å—Ç–Ω—ã–π."
                ]
            else:
                responses = [
                    "–í–æ–ø—Ä–æ—Å –≤–∞—à —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è...\n–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ.",
                    "–ò–∑–≤–æ–ª—å—Ç–µ, —è –æ—Ç–≤–µ—á—É –Ω–∞ –≤–æ–ø—Ä–æ—Å –≤–∞—à,\n–ù–æ –ø–æ–º–Ω–∏—Ç–µ: –∏—Å—Ç–∏–Ω–∞ –º–Ω–æ–≥–æ–≥—Ä–∞–Ω–Ω–∞.",
                    "–í –∫—Ä–∞—Ç–∫–∏—Ö —Å–ª–æ–≤–∞—Ö —Å–∫–∞–∂—É –≤–∞–º:\n–ú—É–¥—Ä–æ—Å—Ç—å –≤ –ø—Ä–æ—Å—Ç–æ—Ç–µ –∑–∞–∫–ª—é—á–µ–Ω–∞."
                ]
        
        # –†–ï–ñ–ò–ú –î–û–°–¢–û–ï–í–°–ö–û–ì–û - –≥–ª—É–±–æ–∫–æ, –Ω–æ –∫—Ä–∞—Ç–∫–æ
        elif author_key == "dostoevsky":
            if is_about_philosophy or is_about_life:
                responses = [
                    "–ö—Ä–∞—Å–æ—Ç–∞ —Å–ø–∞—Å–µ—Ç –º–∏—Ä ‚Äî –≤ —ç—Ç–æ–º –º–æ—è –≤–µ—Ä–∞.",
                    "–°–≤–æ–±–æ–¥–∞ –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –Ω–µ —Å–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–µ–±—è,\n–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤–ª–∞–¥–µ—Ç—å —Å–æ–±–æ–π.",
                    "–°—Ç—Ä–∞–¥–∞–Ω–∏–µ –µ—Å—Ç—å –≥–ª–∞–≤–Ω—ã–π –∏, –º–æ–∂–µ—Ç –±—ã—Ç—å,\n–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–∫–æ–Ω –±—ã—Ç–∏—è –Ω–∞—à–µ–≥–æ."
                ]
            elif "–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ" in user_msg_lower:
                responses = [
                    "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç –Ω–∞–∫–∞–∑–∞–Ω–∏–µ ‚Äî\n—ç—Ç–æ –∑–∞–∫–æ–Ω –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–π.",
                    "–†–∞—Å–∫–æ–ª—å–Ω–∏–∫–æ–≤ –∏—Å–∫–∞–ª –ø—Ä–∞–≤–æ –Ω–∞ –∫—Ä–æ–≤—å,\n–Ω–æ –Ω–∞—à–µ–ª –ª–∏—à—å –º—É–∫–∏ —Å–æ–≤–µ—Å—Ç–∏.",
                    "–ì—Ä–µ—Ö –∏ –∏—Å–∫—É–ø–ª–µ–Ω–∏–µ ‚Äî –≤–µ—á–Ω–∞—è —Ç–µ–º–∞\n—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è."
                ]
            else:
                responses = [
                    "–ß–µ–ª–æ–≤–µ–∫ –µ—Å—Ç—å —Ç–∞–π–Ω–∞. –ï—ë –Ω–∞–¥–æ —Ä–∞–∑–≥–∞–¥–∞—Ç—å.",
                    "–ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–∞–º–æ–º—É —Å–µ–±–µ –Ω–µ –ª–≥–∏—Ç–µ.",
                    "–õ—é–±–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî –∑–Ω–∞—á–∏—Ç –≤–∏–¥–µ—Ç—å –µ–≥–æ —Ç–∞–∫–∏–º,\n–∫–∞–∫–∏–º –µ–≥–æ –∑–∞–º—ã—Å–ª–∏–ª –ë–æ–≥."
                ]
        
        # –†–ï–ñ–ò–ú –¢–û–õ–°–¢–û–ì–û - –º—É–¥—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ
        elif author_key == "tolstoy":
            if is_about_life:
                responses = [
                    "–¶–µ–ª—å –∂–∏–∑–Ω–∏ –Ω–µ –≤ —Å—á–∞—Å—Ç—å–µ,\n–∞ –≤ –¥–æ—Å—Ç–æ–π–Ω–æ–π –∂–∏–∑–Ω–∏.",
                    "–ß—Ç–æ–±—ã –∂–∏—Ç—å —á–µ—Å—Ç–Ω–æ, –Ω–∞–¥–æ —Ä–≤–∞—Ç—å—Å—è,\n–ø—É—Ç–∞—Ç—å—Å—è, –æ—à–∏–±–∞—Ç—å—Å—è.",
                    "–°—á–∞—Å—Ç—å–µ –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å —á—Ç–æ —Ö–æ—á–µ—à—å,\n–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Ö–æ—Ç–µ—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—à—å."
                ]
            elif "–≤–æ–π–Ω–∞" in user_msg_lower:
                responses = [
                    "–í–æ–π–Ω–∞ ‚Äî –ø—Ä–æ—Ç–∏–≤–Ω–æ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º—É —Ä–∞–∑—É–º—É\n–∏ –≤—Å–µ–π —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ —Å–æ–±—ã—Ç–∏–µ.",
                    "–ö—É—Ç—É–∑–æ–≤ –ø–æ–Ω–∏–º–∞–ª: –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Ç–µ—Ä–ø–µ–Ω–∏–µ\n–∏ –≤—Ä–µ–º—è, –∞ –Ω–µ —Å—Ä–∞–∂–µ–Ω–∏—è.",
                    "–ù–∞—Ä–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ –ø–æ–∫–∞–∑–∞–ª–∞ —Å–∏–ª—É –¥—É—Ö–∞ —Ä—É—Å—Å–∫–æ–≥–æ."
                ]
            else:
                responses = [
                    "–í—Å–µ –º—ã—Å–ª–∏, –∏–º–µ—é—â–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –ø—Ä–æ—Å—Ç—ã.",
                    "–ò—Å—Ç–∏–Ω–Ω–∞—è —Å–∏–ª–∞ –≤ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–∏, –∞ –Ω–µ –≤ –ø–æ—Ä—ã–≤–∞—Ö.",
                    "–ñ–∏–≤–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö ‚Äî –≤–æ—Ç —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏."
                ]
        
        # –†–ï–ñ–ò–ú –ì–û–ì–û–õ–Ø - —Å —é–º–æ—Ä–æ–º –∏ –∏—Ä–æ–Ω–∏–µ–π
        elif author_key == "gogol":
            if "–º–µ—Ä—Ç–≤—ã–µ –¥—É—à–∏" in user_msg_lower:
                responses = [
                    "–ß–∏—á–∏–∫–æ–≤ —Å–∫—É–ø–∞–ª –¥—É—à–∏, –∞ –ø—Ä–æ–¥–∞–≤–∞–ª –∏–ª–ª—é–∑–∏–∏.",
                    "–†–æ—Å—Å–∏—è ‚Äî —Ç—Ä–æ–π–∫–∞, –Ω–µ—Å—É—â–∞—è—Å—è –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å.",
                    "–ü–ª—é—à–∫–∏–Ω, –°–æ–±–∞–∫–µ–≤–∏—á, –ú–∞–Ω–∏–ª–æ–≤ ‚Äî\n–≤—Å–µ –æ–Ω–∏ –∂–∏–≤—É—Ç –≤ –∫–∞–∂–¥–æ–º –∏–∑ –Ω–∞—Å."
                ]
            elif "–Ω–æ—Å" in user_msg_lower:
                responses = [
                    "–ù–æ—Å –º–∞–π–æ—Ä–∞ –ö–æ–≤–∞–ª–µ–≤–∞ –∂–∏–ª —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é ‚Äî\n—Ç–∞–∫–æ–≤–∞ –∞–±—Å—É—Ä–¥–Ω–æ—Å—Ç—å —á–∏–Ω–æ–≤–Ω–∏—á—å–µ–π –†–æ—Å—Å–∏–∏.",
                    "–ò—Ä–æ–Ω–∏—è —Å—É–¥—å–±—ã: –Ω–æ—Å —Å—Ç–∞–ª –≤–∞–∂–Ω–µ–µ —á–µ–ª–æ–≤–µ–∫–∞.",
                    "–°–∞—Ç–∏—Ä–∞ ‚Äî –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –æ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –ø–æ—Ä–æ–∫–æ–≤."
                ]
            else:
                responses = [
                    "–°–º–µ—Ö ‚Äî –≤–µ–ª–∏–∫–æ–µ –¥–µ–ª–æ,\n–æ–Ω –Ω–µ –æ—Ç–Ω–∏–º–∞–µ—Ç –Ω–∏ –∂–∏–∑–Ω–∏, –Ω–∏ –∏–º–µ–Ω–∏—è.",
                    "–†—É—Å—å! –ß–µ–≥–æ –∂–µ —Ç—ã —Ö–æ—á–µ—à—å –æ—Ç –º–µ–Ω—è?\n–ù–µ–ø–æ—Å—Ç–∏–∂–∏–º–∞—è —Å—Ç—Ä–∞–Ω–∞!",
                    "–ò –∫–∞–∫–æ–π –∂–µ —Ä—É—Å—Å–∫–∏–π –Ω–µ –ª—é–±–∏—Ç –±—ã—Å—Ç—Ä–æ–π –µ–∑–¥—ã?"
                ]
        
        # –†–ï–ñ–ò–ú –ß–ï–•–û–í–ê - –∫—Ä–∞—Ç–∫–æ –∏ —Ç–æ—á–Ω–æ
        elif author_key == "chekhov":
            if "–≤–∏—à–Ω–µ–≤—ã–π —Å–∞–¥" in user_msg_lower:
                responses = [
                    "–í–∏—à–Ω–µ–≤—ã–π —Å–∞–¥ –ø—Ä–æ–¥–∞–Ω ‚Äî —É—Ö–æ–¥–∏—Ç —ç–ø–æ—Ö–∞.",
                    "–†–∞–Ω–µ–≤—Å–∫–∞—è –Ω–µ –º–æ–≥–ª–∞ –ø–æ–Ω—è—Ç—å:\n–≤—Ä–µ–º—è –Ω–µ—É–º–æ–ª–∏–º–æ.",
                    "¬´–ü—Ä–æ—â–∞–π, —Å—Ç–∞—Ä–∞—è –∂–∏–∑–Ω—å!¬ª ‚Äî\n–∫—Ä–∏—á–∏—Ç –º–æ–ª–æ–¥–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ."
                ]
            elif "–≤—Ä–∞—á" in user_msg_lower or "–º–µ–¥–∏—Ü–∏–Ω–∞" in user_msg_lower:
                responses = [
                    "–ú–µ–¥–∏—Ü–∏–Ω–∞ ‚Äî –º–æ—è –∂–µ–Ω–∞, –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ ‚Äî –ª—é–±–æ–≤–Ω–∏—Ü–∞.",
                    "–í—Ä–∞—á –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –Ω–µ –±–æ–ª–µ–∑–Ω—å, –∞ —á–µ–ª–æ–≤–µ–∫–∞.",
                    "–ö—Ä–∞—Ç–∫–æ—Å—Ç—å –≤ –¥–∏–∞–≥–Ω–æ–∑–µ ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏."
                ]
            else:
                responses = [
                    "–ö—Ä–∞—Ç–∫–æ—Å—Ç—å ‚Äî —Å–µ—Å—Ç—Ä–∞ —Ç–∞–ª–∞–Ω—Ç–∞.",
                    "–í —á–µ–ª–æ–≤–µ–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—Å—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ.",
                    "–ù–∞–¥–æ –ø–æ –∫–∞–ø–ª–µ –≤—ã–¥–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ —Å–µ–±—è —Ä–∞–±–∞."
                ]
        
        # –û–ë–©–ò–ô –†–ï–ñ–ò–ú –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤
        else:
            if is_question:
                responses = [
                    "–í–æ–ø—Ä–æ—Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π. –ü–æ–∑–≤–æ–ª—å—Ç–µ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ...",
                    "–û—Ç–≤–µ—á—É –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –ø—Ä—è–º–æ –∏ —á–µ—Å—Ç–Ω–æ.",
                    "–°—É—Ç—å –≤–æ–ø—Ä–æ—Å–∞ —è—Å–Ω–∞. –í–æ—Ç –º–æ–π –æ—Ç–≤–µ—Ç."
                ]
            else:
                responses = [
                    "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –≤–∞—à–∏ —Å–ª–æ–≤–∞. –ü–æ–¥–µ–ª—é—Å—å –º—ã—Å–ª—å—é...",
                    "–ü–æ–Ω–∏–º–∞—é –≤–∞—Å. –†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—ã—Å–∫–∞–∑–∞—Ç—å—Å—è...",
                    "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è."
                ]
        
        return random.choice(responses)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ main.py)
gigachat_client = None
